# core


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Response Processing

*The core of the Datastar integration involves replacing FastHTML’s
response processing to generate Server-Sent Events (SSE) instead of
traditional HTML responses.*

This function processes FastHTML responses but removes HTMX-specific
headers that aren’t needed for Datastar:

``` python
from fasthtml.common import *
from starlette.testclient import TestClient
```

``` python
# Test with actual FastHTML app and TestClient
app = FastHTML()

@app.get("/test-headers")
def test_headers():
    return Div("Content"), HttpHeader("X-Custom", "test-value")

client = TestClient(app)
response = client.get("/test-headers")
assert response.headers["X-Custom"] == "test-value"
```

``` python
# Test fragment vs full page detection
app = FastHTML(title="Test App")
```

``` python
@app.get("/fragment")
def fragment():
    return Div(id="content")("Fragment content")
```

``` python
client = TestClient(app)
```

Regular request gets full page

``` python
response = client.get("/fragment")
assert "<title>Test App</title>" in response.text
assert "<div id=\"content\">Fragment content</div>" in response.text
```

Datastar request gets fragment only

``` python
response = client.get("/fragment?datastar=true")
# This would be just the fragment in a real implementation
```

Test JSON responses become signals

``` python
app = FastHTML()

@app.get("/signals")
def signals():
    return {"counter": 42, "message": "hello"}

client = TestClient(app)
response = client.get("/signals")
assert response.json() == {"counter": 42, "message": "hello"}
```

## Route Enhancement

------------------------------------------------------------------------

<a
href="https://github.com/Deufel/fastHTML_ds/blob/master/fastHTML_ds/core.py#L95"
target="_blank" style="float:right; font-size:smaller">source</a>

### FastHTML.route

>  FastHTML.route (path:str=None, methods=None, name=None,
>                      include_in_schema=True, body_wrap=None, patch_mode=None,
>                      selector=None, use_view_transition=False)

*Enhanced route decorator with server-driven Datastar patch options*

Update HTTP method shortcuts

``` python
for method in all_meths:
    setattr(FastHTML, method, partialmethod(FastHTML.route, methods=method))
```

``` python
# Test route with patch options
app = FastHTML()

@app.get("/append-item", patch_mode="append", selector="#list")
def append_item():
    return Li("New item")

# Verify the function has Datastar attributes
assert hasattr(append_item, '_datastar_mode')
assert append_item._datastar_mode == "append"
assert append_item._datastar_selector == "#list"
```

## Endpoint Processing

## Monkey Patch Application
